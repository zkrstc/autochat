{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport axios from 'axios';\nexport default {\n  name: 'ArchitecturePage',\n  data() {\n    return {\n      requirements: [],\n      selectedRequirement: '',\n      selectedRequirementId: null,\n      loading: false,\n      error: null,\n      architecture: null,\n      techIcons: {\n        frontend: 'fab fa-vuejs',\n        backend: 'fab fa-python',\n        database: 'fas fa-database'\n      }\n    };\n  },\n  computed: {\n    technologyStack() {\n      if (!this.architecture) return [];\n      return Object.entries(this.architecture.architecture_json.technologyStack).map(([category, value]) => ({\n        category: category.charAt(0).toUpperCase() + category.slice(1),\n        value,\n        icon: this.techIcons[category] || 'fas fa-code'\n      }));\n    }\n  },\n  watch: {\n    requirementId(newVal) {\n      if (newVal) {\n        this.fetchArchitecture(newVal);\n      }\n    }\n  },\n  created() {\n    this.fetchRequirements();\n  },\n  methods: {\n    handleRequirementSelected(id) {\n      this.selectedRequirementId = id;\n      console.log('Selected Requirement ID:', this.selectedRequirementId);\n      this.fetchArchitecture(this.selectedRequirementId);\n      // // In your component logic or template\n      // if (this.architecture) {\n      //     console.log(this.architecture.architecture_json);\n      // } else {\n      //     console.log('Architecture data is not available.');\n      // }\n    },\n    async fetchRequirements() {\n      this.loading = true;\n      this.error = null;\n      try {\n        const response = await axios.get('http://127.0.0.1:5000/api/requirements/list');\n        this.requirements = response.data;\n      } catch (err) {\n        console.error('Error fetching requirements:', err);\n        this.error = '无法加载需求列表';\n      } finally {\n        this.loading = false;\n      }\n    },\n    onRequirementChange() {\n      this.$emit('requirement-selected', this.selectedRequirement);\n    },\n    async fetchArchitecture(requirementId) {\n      this.loading = true;\n      this.error = null;\n      try {\n        const response = await axios.get(`http://127.0.0.1:5000/api/architectures/${requirementId}`, {\n          baseURL: process.env.VUE_APP_API_BASE || window.location.origin,\n          timeout: 10000\n        });\n        if (response.data.error) {\n          throw new Error(response.data.error);\n        }\n        if (response.data.status === 'success') {\n          this.architecture = response.data.data;\n          console.log('Architecture loaded:', this.architecture);\n        } else {\n          console.error('Error:', response.data.message);\n        }\n      } catch (err) {\n        console.error('Error fetching architecture:', err);\n        this.error = err.response?.data?.error || err.message || '获取架构信息失败';\n        this.architecture = null;\n\n        // 可以在这里添加更多特定的错误处理\n        if (err.response?.status === 404) {\n          this.error = \"未找到对应的架构设计\";\n        }\n      } finally {\n        this.loading = false;\n      }\n    },\n    downloadDiagram() {\n      if (!this.architecture) return;\n\n      // Implement download functionality\n      const blob = new Blob([this.architecture.architecture_json.architectureDiagram.diagram], {\n        type: 'text/plain'\n      });\n      const link = document.createElement('a');\n      link.href = URL.createObjectURL(blob);\n      link.download = `architecture-${this.architecture.id}.txt`;\n      link.click();\n    }\n  }\n};","map":{"version":3,"names":["axios","name","data","requirements","selectedRequirement","selectedRequirementId","loading","error","architecture","techIcons","frontend","backend","database","computed","technologyStack","Object","entries","architecture_json","map","category","value","charAt","toUpperCase","slice","icon","watch","requirementId","newVal","fetchArchitecture","created","fetchRequirements","methods","handleRequirementSelected","id","console","log","response","get","err","onRequirementChange","$emit","baseURL","process","env","VUE_APP_API_BASE","window","location","origin","timeout","Error","status","message","downloadDiagram","blob","Blob","architectureDiagram","diagram","type","link","document","createElement","href","URL","createObjectURL","download","click"],"sources":["C:\\Users\\ASUS\\Desktop\\autochat\\frontend\\src\\views\\ArchitecturePage.vue"],"sourcesContent":["<template>\r\n    <div class=\"p-8\">\r\n        <!-- 需求选择和生成按钮 -->\r\n        <div class=\"flex items-center justify-between mb-6\">\r\n            <div class=\"flex items-center space-x-4\">\r\n                <div class=\"text-lg font-medium\">需求选择：</div>\r\n                <select v-model=\"selectedRequirement\"\r\n                    class=\"border border-gray-300 rounded-button px-4 py-2 min-w-[200px] focus:outline-none focus:ring-2 focus:ring-primary\"\r\n                    @change=\"handleRequirementSelected(selectedRequirement)\">\r\n                    <option disabled value=\"\">请选择需求</option>\r\n                    <option v-for=\"req in requirements\" :key=\"req.id\" :value=\"req.id\">\r\n                        {{ req.name }} v{{ req.version }}\r\n                    </option>\r\n                </select>\r\n            </div>\r\n            <button id=\"generateBtn\"\r\n                class=\"px-6 py-2 bg-primary text-white !rounded-button hover:bg-blue-600 transition-colors\">\r\n                <i class=\"fas fa-magic mr-2\"></i>生成架构\r\n            </button>\r\n        </div>\r\n\r\n        <!-- 架构展示区域 -->\r\n        <div class=\"bg-white rounded-lg shadow p-6 mb-6\">\r\n            <div class=\"flex items-center justify-between mb-4\">\r\n                <div class=\"flex items-center\">\r\n                    <i class=\"fas fa-sitemap text-primary text-xl\"></i>\r\n                    <h3 class=\"ml-2 text-lg font-medium\">系统架构图</h3>\r\n                </div>\r\n                <div class=\"flex space-x-2\">\r\n                    <button @click=\"downloadDiagram\" class=\"px-4 py-2 border border-gray-300 !rounded-button\">\r\n                        <i class=\"fas fa-download mr-2\"></i>下载\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div id=\"architectureContainer\" class=\"architecture-diagram\">\r\n                <div v-if=\"!architecture\" class=\"text-center\">\r\n                    <i class=\"fas fa-sitemap text-4xl mb-2\"></i>\r\n                    <p>请选择需求并点击\"生成架构\"按钮</p>\r\n                </div>\r\n                <pre v-else\r\n                    class=\"bg-gray-100 p-4 rounded overflow-auto\">{{ architecture.architecture_json.architectureDiagram.diagram }}</pre>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- 技术栈和模块划分 -->\r\n        <div class=\"grid grid-cols-2 gap-6\">\r\n            <!-- 技术栈 -->\r\n            <div class=\"bg-white rounded-lg shadow p-6\">\r\n                <div class=\"flex items-center mb-4\">\r\n                    <i class=\"fas fa-code-branch text-primary text-xl\"></i>\r\n                    <h3 class=\"ml-2 text-lg font-medium\">推荐技术栈</h3>\r\n                </div>\r\n                <div id=\"techStackContainer\" class=\"space-y-3\">\r\n                    <div v-if=\"!architecture\" class=\"text-center text-gray-500 py-10\">\r\n                        <i class=\"fas fa-cog text-4xl mb-2\"></i>\r\n                        <p>架构生成后将显示推荐技术栈</p>\r\n                    </div>\r\n                    <div v-else>\r\n                        <div v-for=\"(tech, index) in technologyStack\" :key=\"index\" class=\"flex items-start\">\r\n                            <div class=\"bg-gray-100 rounded-full p-2 mr-3\">\r\n                                <i :class=\"tech.icon\" class=\"text-primary\"></i>\r\n                            </div>\r\n                            <div>\r\n                                <h4 class=\"font-medium\">{{ tech.category }}</h4>\r\n                                <p class=\"text-gray-600\">{{ tech.value }}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- 模块划分 -->\r\n            <div class=\"bg-white rounded-lg shadow p-6\">\r\n                <div class=\"flex items-center mb-4\">\r\n                    <i class=\"fas fa-tasks text-primary text-xl\"></i>\r\n                    <h3 class=\"ml-2 text-lg font-medium\">模块划分</h3>\r\n                </div>\r\n                <div id=\"modulesContainer\" class=\"space-y-3\">\r\n                    <div v-if=\"!architecture\" class=\"text-center text-gray-500 py-10\">\r\n                        <i class=\"fas fa-project-diagram text-4xl mb-2\"></i>\r\n                        <p>架构生成后将显示模块划分</p>\r\n                    </div>\r\n                    <div v-else>\r\n                        <div v-for=\"(module, index) in architecture.architecture_json.modules\" :key=\"index\"\r\n                            class=\"flex items-center p-3 bg-gray-50 rounded\">\r\n                            <i class=\"fas fa-cube text-primary mr-3\"></i>\r\n                            <span>{{ module }}</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\nexport default {\r\n    name: 'ArchitecturePage',\r\n    data() {\r\n        return {\r\n            requirements: [],\r\n            selectedRequirement: '',\r\n            selectedRequirementId: null,\r\n            loading: false,\r\n            error: null,\r\n            architecture: null,\r\n\r\n            techIcons: {\r\n                frontend: 'fab fa-vuejs',\r\n                backend: 'fab fa-python',\r\n                database: 'fas fa-database'\r\n            }\r\n        }\r\n    },\r\n    computed: {\r\n        technologyStack() {\r\n            if (!this.architecture) return [];\r\n\r\n            return Object.entries(this.architecture.architecture_json.technologyStack).map(\r\n                ([category, value]) => ({\r\n                    category: category.charAt(0).toUpperCase() + category.slice(1),\r\n                    value,\r\n                    icon: this.techIcons[category] || 'fas fa-code'\r\n                })\r\n            );\r\n        }\r\n    },\r\n    watch: {\r\n        requirementId(newVal) {\r\n            if (newVal) {\r\n                this.fetchArchitecture(newVal);\r\n            }\r\n        }\r\n    },\r\n    created() {\r\n        this.fetchRequirements();\r\n    },\r\n    methods: {\r\n        handleRequirementSelected(id) {\r\n            this.selectedRequirementId = id;\r\n            console.log('Selected Requirement ID:', this.selectedRequirementId);\r\n            this.fetchArchitecture(this.selectedRequirementId);\r\n            // // In your component logic or template\r\n            // if (this.architecture) {\r\n            //     console.log(this.architecture.architecture_json);\r\n            // } else {\r\n            //     console.log('Architecture data is not available.');\r\n            // }\r\n        },\r\n        async fetchRequirements() {\r\n            this.loading = true;\r\n            this.error = null;\r\n            try {\r\n                const response = await axios.get('http://127.0.0.1:5000/api/requirements/list');\r\n                this.requirements = response.data;\r\n            } catch (err) {\r\n                console.error('Error fetching requirements:', err);\r\n                this.error = '无法加载需求列表';\r\n            } finally {\r\n                this.loading = false;\r\n            }\r\n        },\r\n        onRequirementChange() {\r\n            this.$emit('requirement-selected', this.selectedRequirement);\r\n        },\r\n        async fetchArchitecture(requirementId) {\r\n            this.loading = true;\r\n            this.error = null;\r\n\r\n            try {\r\n                const response = await axios.get(`http://127.0.0.1:5000/api/architectures/${requirementId}`, {\r\n                    baseURL: process.env.VUE_APP_API_BASE || window.location.origin,\r\n                    timeout: 10000\r\n                });\r\n\r\n                if (response.data.error) {\r\n                    throw new Error(response.data.error);\r\n                }\r\n\r\n                if (response.data.status === 'success') {\r\n                    this.architecture = response.data.data;\r\n                    console.log('Architecture loaded:', this.architecture);\r\n                } else {\r\n                    console.error('Error:', response.data.message);\r\n                }\r\n\r\n            } catch (err) {\r\n                console.error('Error fetching architecture:', err);\r\n                this.error = err.response?.data?.error ||\r\n                    err.message ||\r\n                    '获取架构信息失败';\r\n                this.architecture = null;\r\n\r\n                // 可以在这里添加更多特定的错误处理\r\n                if (err.response?.status === 404) {\r\n                    this.error = \"未找到对应的架构设计\";\r\n                }\r\n            } finally {\r\n                this.loading = false;\r\n            }\r\n        },\r\n        downloadDiagram() {\r\n            if (!this.architecture) return;\r\n\r\n            // Implement download functionality\r\n            const blob = new Blob([this.architecture.architecture_json.architectureDiagram.diagram],\r\n                { type: 'text/plain' });\r\n            const link = document.createElement('a');\r\n            link.href = URL.createObjectURL(blob);\r\n            link.download = `architecture-${this.architecture.id}.txt`;\r\n            link.click();\r\n        }\r\n    }\r\n}\r\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}