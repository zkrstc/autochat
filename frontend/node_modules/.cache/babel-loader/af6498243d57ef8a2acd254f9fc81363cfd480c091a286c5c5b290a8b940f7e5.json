{"ast":null,"code":"import axios from 'axios';\nexport default {\n  name: 'TestPage',\n  data() {\n    return {\n      // 已有数据...\n      showEditModal: false,\n      editData: {\n        id: null,\n        input_data: '',\n        expected_output: ''\n      },\n      error: null,\n      selectedRequirement: '',\n      selectedRequirementId: null,\n      testCases: [],\n      loading: false,\n      generating: false\n    };\n  },\n  created() {\n    this.fetchRequirements();\n  },\n  methods: {\n    handleRequirementSelected(id) {\n      this.selectedRequirementId = id;\n      console.log('Selected Requirement ID:', this.selectedRequirementId);\n      this.fetchTestCases(this.selectedRequirementId);\n    },\n    async fetchRequirements() {\n      this.loading = true;\n      this.error = null;\n      try {\n        const response = await axios.get('http://127.0.0.1:5000/api/requirements/list');\n        this.requirements = response.data;\n      } catch (err) {\n        console.error('Error fetching requirements:', err);\n        this.error = '无法加载需求列表';\n      } finally {\n        this.loading = false;\n      }\n    },\n    async fetchTestCases(requirementId) {\n      this.loading = true;\n      try {\n        const response = await axios.get('http://127.0.0.1:5000/api/test_cases', {\n          params: {\n            requirement_id: requirementId\n          }\n        });\n        this.testCases = response.data.data || [];\n        console.log('Fetched test cases:', this.testCases);\n      } catch (error) {\n        console.error('获取测试用例失败:', error);\n        this.testCases = [];\n      } finally {\n        this.loading = false;\n      }\n    },\n    async generateTestCases() {\n      if (!this.selectedRequirement) return;\n      this.generating = true;\n      try {\n        const response = await axios.post('http://127.0.0.1:5000/api/test_cases/generate', {\n          requirement_id: this.selectedRequirement\n        });\n        this.$toast.success(response.data.message);\n        await this.fetchTestCases(this.selectedRequirement);\n      } catch (error) {\n        console.error('生成测试用例失败:', error);\n        this.$toast.error(error.response?.data?.error || '生成失败');\n      } finally {\n        this.generating = false;\n      }\n    },\n    formatJson(jsonStr) {\n      try {\n        const obj = JSON.parse(jsonStr);\n        return JSON.stringify(obj, null, 2);\n      } catch {\n        return jsonStr;\n      }\n    },\n    formatDate(dateStr) {\n      return dateStr ? new Date(dateStr).toLocaleString() : '-';\n    },\n    getTypeBadgeClass(type) {\n      const classes = {\n        login: 'bg-blue-100 text-blue-800',\n        purchase: 'bg-green-100 text-green-800',\n        default: 'bg-gray-100 text-gray-800'\n      };\n      return classes[type] || classes.default;\n    },\n    openEditModal(testCase) {\n      this.editData = {\n        id: testCase.id,\n        input_data: testCase.input_data,\n        expected_output: testCase.expected_output\n      };\n      this.showEditModal = true;\n    },\n    submitEdit() {\n      axios.put(`http://127.0.0.1:5000/api/test_cases/${this.editData.id}`, {\n        input_data: this.editData.input_data,\n        expected_output: this.editData.expected_output\n      }).then(() => {\n        this.showEditModal = false;\n        this.fetchTestCases(); // 刷新数据\n      }).catch(err => {\n        console.error('更新失败', err);\n      });\n    },\n    deleteTestCase(id) {\n      if (!confirm('确定删除该测试用例吗？')) return;\n      axios.delete(`http://127.0.0.1:5000/api/test_cases/${id}`).then(() => {\n        this.fetchTestCases();\n      }).catch(err => {\n        console.error('删除失败', err);\n      });\n    }\n  },\n  watch: {\n    selectedRequirement(newVal) {\n      if (newVal) {\n        this.fetchTestCases(newVal);\n      } else {\n        this.testCases = [];\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","name","data","showEditModal","editData","id","input_data","expected_output","error","selectedRequirement","selectedRequirementId","testCases","loading","generating","created","fetchRequirements","methods","handleRequirementSelected","console","log","fetchTestCases","response","get","requirements","err","requirementId","params","requirement_id","generateTestCases","post","$toast","success","message","formatJson","jsonStr","obj","JSON","parse","stringify","formatDate","dateStr","Date","toLocaleString","getTypeBadgeClass","type","classes","login","purchase","default","openEditModal","testCase","submitEdit","put","then","catch","deleteTestCase","confirm","delete","watch","newVal"],"sources":["C:\\Users\\ASUS\\Desktop\\autochat\\frontend\\src\\views\\TestPage.vue"],"sourcesContent":["<template>\r\n    <div class=\"p-8\">\r\n        <!-- 需求选择和生成按钮 -->\r\n        <div class=\"flex items-center justify-between mb-6\">\r\n            <div class=\"flex items-center space-x-4\">\r\n                <div class=\"text-lg font-medium\">需求选择：</div>\r\n                <select v-model=\"selectedRequirement\"\r\n                    class=\"border border-gray-300 rounded-button px-4 py-2 min-w-[200px] focus:outline-none focus:ring-2 focus:ring-primary\"\r\n                    @change=\"handleRequirementSelected(selectedRequirement)\">\r\n                    <option disabled value=\"\">请选择需求</option>\r\n                    <option v-for=\"req in requirements\" :key=\"req.id\" :value=\"req.id\">\r\n                        {{ req.name }} v{{ req.version }}\r\n                    </option>\r\n                </select>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"bg-white rounded-lg shadow p-6 mb-6\">\r\n            <div class=\"flex justify-between items-center mb-6\">\r\n                <h2 class=\"text-lg font-medium\">测试用例列表</h2>\r\n                <button class=\"bg-primary text-white px-4 py-2 !rounded-button flex items-center\">\r\n                    <i class=\"fas fa-plus mr-2\"></i>生成测试用例\r\n                </button>\r\n            </div>\r\n            <div class=\"overflow-x-auto\">\r\n                <table class=\"w-full\">\r\n                    <thead>\r\n                        <tr class=\"bg-gray-50\">\r\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">ID</th>\r\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">类型</th>\r\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">输入数据</th>\r\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">预期输出</th>\r\n                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">操作</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody class=\"divide-y divide-gray-200\">\r\n                        <!-- 加载状态 -->\r\n                        <tr v-if=\"loading\">\r\n                            <td colspan=\"5\" class=\"px-6 py-4 text-center\">\r\n                                <i class=\"fas fa-spinner fa-spin mr-2\"></i>加载中...\r\n                            </td>\r\n                        </tr>\r\n\r\n                        <!-- 空状态 -->\r\n                        <tr v-else-if=\"testCases.length === 0\">\r\n                            <td colspan=\"5\" class=\"px-6 py-4 text-center text-gray-500\">\r\n                                没有找到测试用例\r\n                            </td>\r\n                        </tr>\r\n\r\n                        <!-- 测试用例数据 -->\r\n                        <tr v-for=\"testCase in testCases\" :key=\"testCase.id\" class=\"hover:bg-gray-50\">\r\n                            <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">{{ testCase.id }}</td>\r\n                            <td class=\"px-6 py-4 whitespace-nowrap\">\r\n                                <span class=\"px-2 py-1 text-xs rounded-full\" :class=\"getTypeBadgeClass(testCase.type)\">\r\n                                    {{ testCase.type }}\r\n                                </span>\r\n                            </td>\r\n                            <td class=\"px-6 py-4 text-sm text-gray-500 max-w-xs truncate\">\r\n                                <pre class=\"truncate\">{{ formatJson(testCase.input_data) }}</pre>\r\n                            </td>\r\n                            <td class=\"px-6 py-4 text-sm text-gray-500 max-w-xs truncate\">\r\n                                <pre class=\"truncate\">{{ formatJson(testCase.expected_output) }}</pre>\r\n                            </td>\r\n                            <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                                <button @click=\"openEditModal(testCase)\"\r\n                                    class=\"text-blue-500 hover:underline\">修改</button>\r\n                                <button @click=\"deleteTestCase(testCase.id)\"\r\n                                    class=\"text-red-500 hover:underline ml-2\">删除</button>\r\n                            </td>\r\n                        </tr>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n\r\n\r\n    </div>\r\n\r\n    <!-- 弹窗编辑框 -->\r\n    <div v-if=\"showEditModal\" class=\"fixed inset-0 bg-gray-900 bg-opacity-50 flex justify-center items-center z-50\">\r\n        <div class=\"bg-white p-6 rounded shadow w-96\">\r\n            <h3 class=\"text-lg font-semibold mb-4\">编辑测试用例</h3>\r\n            <div class=\"mb-4\">\r\n                <label class=\"block text-sm\">输入数据：</label>\r\n                <textarea v-model=\"editData.input_data\" class=\"w-full border p-2 text-sm\" rows=\"3\"></textarea>\r\n            </div>\r\n            <div class=\"mb-4\">\r\n                <label class=\"block text-sm\">预期输出：</label>\r\n                <textarea v-model=\"editData.expected_output\" class=\"w-full border p-2 text-sm\" rows=\"3\"></textarea>\r\n            </div>\r\n            <div class=\"flex justify-end space-x-2\">\r\n                <button @click=\"showEditModal = false\" class=\"text-gray-600\">取消</button>\r\n                <button @click=\"submitEdit\" class=\"bg-blue-500 text-white px-4 py-1 rounded\">保存</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n</template>\r\n  \r\n  <script>\r\n  import axios from 'axios';\r\n  export default {\r\n    name: 'TestPage',\r\n    data() {\r\n        return {\r\n            // 已有数据...\r\n            showEditModal: false,\r\n            editData: {\r\n                id: null,\r\n                input_data: '',\r\n                expected_output: ''\r\n            },\r\n            error: null,\r\n            selectedRequirement: '',\r\n            selectedRequirementId: null,\r\n            testCases: [],\r\n            loading: false,\r\n            generating: false\r\n        }\r\n    },\r\n    created() {\r\n        this.fetchRequirements();\r\n    },\r\n    methods: {\r\n        \r\n        handleRequirementSelected(id) {\r\n            this.selectedRequirementId = id;\r\n            console.log('Selected Requirement ID:', this.selectedRequirementId);\r\n            this.fetchTestCases(this.selectedRequirementId);\r\n        },\r\n        async fetchRequirements() {\r\n            this.loading = true;\r\n            this.error = null;\r\n            try {\r\n                const response = await axios.get('http://127.0.0.1:5000/api/requirements/list');\r\n                this.requirements = response.data;\r\n            } catch (err) {\r\n                console.error('Error fetching requirements:', err);\r\n                this.error = '无法加载需求列表';\r\n            } finally {\r\n                this.loading = false;\r\n            }\r\n        },\r\n        async fetchTestCases(requirementId) {\r\n            this.loading = true;\r\n            try {\r\n                const response = await axios.get('http://127.0.0.1:5000/api/test_cases', {\r\n                    params: { requirement_id: requirementId }\r\n                });\r\n                this.testCases = response.data.data || [];\r\n                console.log('Fetched test cases:', this.testCases);\r\n            } catch (error) {\r\n                console.error('获取测试用例失败:', error);\r\n                this.testCases = [];\r\n            } finally {\r\n                this.loading = false;\r\n            }\r\n        },\r\n\r\n        async generateTestCases() {\r\n            if (!this.selectedRequirement) return;\r\n\r\n            this.generating = true;\r\n            try {\r\n                const response = await axios.post('http://127.0.0.1:5000/api/test_cases/generate', {\r\n                    requirement_id: this.selectedRequirement\r\n                });\r\n\r\n                this.$toast.success(response.data.message);\r\n                await this.fetchTestCases(this.selectedRequirement);\r\n            } catch (error) {\r\n                console.error('生成测试用例失败:', error);\r\n                this.$toast.error(error.response?.data?.error || '生成失败');\r\n            } finally {\r\n                this.generating = false;\r\n            }\r\n        },\r\n\r\n        formatJson(jsonStr) {\r\n            try {\r\n                const obj = JSON.parse(jsonStr);\r\n                return JSON.stringify(obj, null, 2);\r\n            } catch {\r\n                return jsonStr;\r\n            }\r\n        },\r\n\r\n        formatDate(dateStr) {\r\n            return dateStr ? new Date(dateStr).toLocaleString() : '-';\r\n        },\r\n\r\n        getTypeBadgeClass(type) {\r\n            const classes = {\r\n                login: 'bg-blue-100 text-blue-800',\r\n                purchase: 'bg-green-100 text-green-800',\r\n                default: 'bg-gray-100 text-gray-800'\r\n            };\r\n            return classes[type] || classes.default;\r\n        },\r\n        openEditModal(testCase) {\r\n            this.editData = {\r\n                id: testCase.id,\r\n                input_data: testCase.input_data,\r\n                expected_output: testCase.expected_output\r\n            }\r\n            this.showEditModal = true\r\n        },\r\n        submitEdit() {\r\n            axios\r\n                .put(`http://127.0.0.1:5000/api/test_cases/${this.editData.id}`, {\r\n                    input_data: this.editData.input_data,\r\n                    expected_output: this.editData.expected_output\r\n                })\r\n                .then(() => {\r\n                    this.showEditModal = false\r\n                    this.fetchTestCases() // 刷新数据\r\n                })\r\n                .catch(err => {\r\n                    console.error('更新失败', err)\r\n                })\r\n        },\r\n        deleteTestCase(id) {\r\n            if (!confirm('确定删除该测试用例吗？')) return\r\n            axios\r\n                .delete(`http://127.0.0.1:5000/api/test_cases/${id}`)\r\n                .then(() => {\r\n                    this.fetchTestCases()\r\n                })\r\n                .catch(err => {\r\n                    console.error('删除失败', err)\r\n                })\r\n        }\r\n    },\r\n    watch: {\r\n        selectedRequirement(newVal) {\r\n            if (newVal) {\r\n                this.fetchTestCases(newVal);\r\n            } else {\r\n                this.testCases = [];\r\n            }\r\n        }\r\n    }\r\n  }\r\n  </script>\r\n  "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}